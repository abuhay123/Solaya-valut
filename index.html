<script>
  const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
  let keypair;

  async function connectWallet() {
    const errorEl = document.getElementById("error");
    errorEl.innerText = "";
    let mnemonic = document.getElementById("mnemonic").value.trim();

    if (mnemonic.split(" ").length !== 12) {
      errorEl.innerText = "âŒ ×™×© ×œ×”×–×™×Ÿ ×‘×“×™×•×§ 12 ××™×œ×™×.";
      return;
    }

    try {
      const seed = await window.browserBip39.mnemonicToSeed(mnemonic); // ğŸ’¥ ×–×• ×”×©×•×¨×” ×”× ×›×•× ×”!
      const hex = Array.from(seed).map(b => b.toString(16).padStart(2, '0')).join('');
      const derived = ed25519HdKey.derivePath("m/44'/501'/0'/0'", hex).key;
      keypair = solanaWeb3.Keypair.fromSeed(derived);

      const pubkey = keypair.publicKey.toBase58();
      document.getElementById("pubkey").innerText = pubkey;

      const balanceLamports = await connection.getBalance(keypair.publicKey);
      document.getElementById("balance").innerText = (balanceLamports / solanaWeb3.LAMPORTS_PER_SOL).toFixed(4);

      document.getElementById("login").classList.add("hidden");
      document.getElementById("wallet-info").classList.remove("hidden");

      QRCode.toCanvas(document.getElementById('qrcode'), pubkey, function (error) {
        if (error) console.error(error);
      });
    } catch (e) {
      errorEl.innerText = "âŒ ×©×’×™××”: " + e.message;
    }
  }
</script>
