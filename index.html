<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Solaya Exchange</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="assets/icon.png">
  <link rel="apple-touch-icon" href="assets/icon.png">
  <meta name="theme-color" content="#000000">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@latest/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bip39@3.0.4/dist/index.browser.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ed25519-hd-key@1.1.1/dist/index.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bs58@5.0.0/dist/bs58.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: #0a0a0a;
      color: #fff;
    }
    header {
      background: #111;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 2px solid #00ffc3;
    }
    header h1 {
      margin: 0;
      font-size: 20px;
      color: #00ffc3;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { text-shadow: 0 0 5px #00ffc3; }
      50% { text-shadow: 0 0 15px #00ffc3; }
    }
    nav {
      background: #1a1a1a;
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      border-bottom: 1px solid #333;
    }
    nav a {
      color: #00ffc3;
      text-decoration: none;
      font-weight: bold;
      transition: 0.3s;
    }
    nav a:hover {
      text-shadow: 0 0 10px #00ffc3;
    }
    main { padding: 20px; }
    input, button, select {
      display: block;
      width: 100%;
      margin: 10px auto;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
    }
    input, select {
      background: #1e1e1e;
      color: #fff;
    }
    button {
      background: #00ffc3;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }
    .hidden { display: none; }
    .section {
      background: #141414;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px #000;
    }
    .profile { text-align: left; margin-bottom: 20px; }
    .profile p { margin: 5px 0; }
    canvas { background: #1c1c1c; border-radius: 10px; margin-top: 20px; }
  </style>
</head>
<body>
<header><h1>Solaya Exchange</h1></header>

<nav>
  <a href="#" onclick="showSection('register')">×¨×™×©×•×</a>
  <a href="#" onclick="showSection('login')">×”×ª×—×‘×¨×•×ª</a>
  <a href="#" onclick="showSection('wallet')">××¨× ×§</a>
  <a href="#" onclick="showSection('trade')">××¡×—×¨</a>
  <a href="#" onclick="showSection('settings')">×”×’×“×¨×•×ª</a>
</nav>

<main>
  <!-- ×¨×™×©×•× -->
  <div id="register" class="section">
    <h2>ğŸ§¾ ×¨×™×©×•×</h2>
    <input id="regName" placeholder="×©× ×¤×¨×˜×™" />
    <input id="regLast" placeholder="×©× ××©×¤×—×”" />
    <input id="regEmail" placeholder="××™××™×™×œ" />
    <button onclick="saveUser()">ğŸ“¥ ×¨×™×©×•×</button>
  </div>

  <!-- ×”×ª×—×‘×¨×•×ª -->
  <div id="login" class="section hidden">
    <h2>ğŸ” ×”×ª×—×‘×¨×•×ª ×œ××¨× ×§</h2>
    <input id="mnemonic" placeholder="12 ××™×œ×™×" />
    <button onclick="connectWallet()">×”×ª×—×‘×¨ ×¢× ××™×œ×™×</button>
    <input id="privateKey" placeholder="Private Key (Base58)" />
    <button onclick="connectWithPrivateKey()">×”×ª×—×‘×¨ ×¢× Private Key</button>
  </div>

  <!-- ××¨× ×§ -->
  <div id="wallet" class="section hidden">
    <h2>ğŸ’¼ ×”××¨× ×§</h2>
    <p><b>×›×ª×•×‘×ª:</b> <span id="pubkey"></span></p>
    <p><b>×™×ª×¨×”:</b> <span id="balance">...</span> SOL</p>
    <input id="toAddress" placeholder="×›×ª×•×‘×ª ×™×¢×“" />
    <input id="amount" placeholder="×›××•×ª SOL" />
    <button onclick="sendSol()">ğŸš€ ×©×œ×— SOL</button>
    <p id="tx-status"></p>
  </div>

  <!-- ××¡×—×¨ -->
  <div id="trade" class="section hidden">
    <h2>ğŸ“ˆ ××¡×—×¨</h2>
    <select id="tokenSelector">
      <option value="SOL">SOL</option>
      <option value="USDC">USDC</option>
      <option value="TROLL">TROLL (Pump.fun)</option>
    </select>
    <canvas id="priceChart" width="400" height="200"></canvas>
    <input id="tradeAmount" placeholder="×›××•×ª ×œ×¨×›×™×©×”/××›×™×¨×”" />
    <button onclick="buyToken()">ğŸŸ¢ ×§× ×™×™×”</button>
    <button onclick="sellToken()">ğŸ”´ ××›×™×¨×”</button>
    <p id="tradeStatus"></p>
  </div>
  <!-- ×”×’×“×¨×•×ª -->
  <div id="settings" class="section hidden">
    <h2>âš™ï¸ ×”×’×“×¨×•×ª</h2>
    <div class="profile">
      <p><b>×©×:</b> <span id="profName"></span></p>
      <p><b>××™××™×™×œ:</b> <span id="profEmail"></span></p>
    </div>
    <button onclick="logout()">ğŸšª ×”×ª× ×ª×§×•×ª</button>
  </div>
</main>

<script>
  let keypair;
  const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));

  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    if (id === "settings") loadProfile();
    if (id === "trade") drawChart();
  }

  function saveUser() {
    const u = {
      name: document.getElementById('regName').value,
      last: document.getElementById('regLast').value,
      email: document.getElementById('regEmail').value
    };
    localStorage.setItem("user", JSON.stringify(u));
    alert("âœ… × ×¨×©××ª ×‘×”×¦×œ×—×”!");
    showSection('login');
  }

  function loadProfile() {
    const u = JSON.parse(localStorage.getItem("user"));
    if (u) {
      document.getElementById("profName").innerText = u.name + " " + u.last;
      document.getElementById("profEmail").innerText = u.email;
    }
  }

  async function connectWallet() {
    const m = document.getElementById("mnemonic").value.trim();
    if (m.split(" ").length !== 12) return alert("âŒ 12 ××™×œ×™× ×‘×“×™×•×§.");
    const seed = await bip39.mnemonicToSeed(m);
    const hex = Array.from(seed).map(b => b.toString(16).padStart(2, '0')).join('');
    const derived = ed25519HdKey.derivePath("m/44'/501'/0'/0'", hex).key;
    keypair = solanaWeb3.Keypair.fromSeed(derived);
    await afterConnection();
  }

  async function connectWithPrivateKey() {
    try {
      const priv = document.getElementById("privateKey").value.trim();
      keypair = solanaWeb3.Keypair.fromSecretKey(bs58.decode(priv));
      await afterConnection();
    } catch (e) {
      alert("âŒ ×©×’×™××”: " + e.message);
    }
  }

  async function afterConnection() {
    const pub = keypair.publicKey.toBase58();
    document.getElementById("pubkey").innerText = pub;
    const balance = await connection.getBalance(keypair.publicKey);
    document.getElementById("balance").innerText = (balance / solanaWeb3.LAMPORTS_PER_SOL).toFixed(4);
    showSection("wallet");
  }

  async function sendSol() {
    const to = document.getElementById("toAddress").value.trim();
    const lamports = parseFloat(document.getElementById("amount").value) * solanaWeb3.LAMPORTS_PER_SOL;
    const status = document.getElementById("tx-status");
    try {
      const tx = new solanaWeb3.Transaction().add(
        solanaWeb3.SystemProgram.transfer({
          fromPubkey: keypair.publicKey,
          toPubkey: new solanaWeb3.PublicKey(to),
          lamports
        })
      );
      const sig = await solanaWeb3.sendAndConfirmTransaction(connection, tx, [keypair]);
      status.innerText = "âœ… × ×©×œ×— ×‘×”×¦×œ×—×”:\n" + sig;
    } catch (err) {
      status.innerText = "âŒ ×©×’×™××”: " + err.message;
    }
  }

  function logout() { location.reload(); }

  function drawChart() {
    const ctx = document.getElementById('priceChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
        datasets: [{
          label: '××—×™×¨ ××“×•××”',
          data: [1.00, 1.15, 1.12, 1.2, 1.18, 1.25],
          borderColor: '#00ffc3',
          backgroundColor: 'rgba(0,255,195,0.1)',
          tension: 0.4
        }]
      },
      options: {
        scales: { x: { ticks: { color: '#fff' } }, y: { ticks: { color: '#fff' } } },
        plugins: { legend: { labels: { color: '#fff' } } }
      }
    });
  }

  function buyToken() {
    const t = document.getElementById("tokenSelector").value;
    const a = document.getElementById("tradeAmount").value;
    document.getElementById("tradeStatus").innerText = `âœ… × ×¨×›×©×” ×›××•×ª ${a} ×©×œ ${t} (××“×•××”)`;
  }

  function sellToken() {
    const t = document.getElementById("tokenSelector").value;
    const a = document.getElementById("tradeAmount").value;
    document.getElementById("tradeStatus").innerText = `âœ… × ××›×¨×” ×›××•×ª ${a} ×©×œ ${t} (××“×•××”)`;
  }

  showSection('register');
</script>
</body>
</html>
